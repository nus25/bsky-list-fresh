"use strict";(()=>{var y={en:{pageTitle:"Bsky List Fresh",pageDescription:"Check the last addition date of Bluesky lists",submitText:"Check",submitTextLoading:"Checking...",labelCreator:"Creator",labelPurpose:"Type",labelDescription:"Description",labelItemCount:"Items",labelLastUpdated:"Last Updated",purposeList:"List",purposeModList:"Moderation List",errorInvalidUri:"The provided input does not seem to be a valid list",errorGeneric:"An error occurred. Please try again later.",errorListNotFound:"List not found. Please check the URL.",noItems:"This list has no items",noDescription:"No description",labelAcceptTos:"I accept the",tosLinkText:"Terms of Service",tosLoadError:"Failed to load terms of service.",tosContainerNotFound:"Terms content not found.",helpTitle:"How to use",helpBody:`
            <p><strong>What does this tool do?</strong></p>
            <p>This tool checks when the most recent user was added to a Bluesky list.</p>
            
            <p><strong>How to use:</strong></p>
            <ol>
                <li>Go to Bluesky and find the list you want to check</li>
                <li>Copy the list URL:
                    <ul>
	                    <li>Use the "Copy link to list" in "..." menu of Bluesky client</li>
                        <li>Or copy from your browser's address bar (e.g., <code>https://bsky.app/profile/nus.bsky.social/lists/3khbcfekugt2j</code>)</li>
                    </ul>
                </li>
                <li>Paste it into the input field and select "Check" to see the last addition date</li>
            </ol>
            
            <p><strong>Alternative:</strong> You can also use the list's AT URI directly (e.g., <code>at://did:plc:v2tssqq5tlnx4f5qvtpnlw5j/app.bsky.graph.list/3khbcfekugt2j</code>)</p>
			<p><strong>Note:</strong> The date is based on the latest record present in the list.</p>
			`},ja:{pageTitle:"Bsky List Fresh",pageDescription:"Bluesky\u30EA\u30B9\u30C8\u306E\u6700\u7D42\u8FFD\u52A0\u65E5\u3092\u78BA\u8A8D\u3057\u307E\u3059",submitText:"\u78BA\u8A8D",submitTextLoading:"\u78BA\u8A8D\u4E2D...",labelCreator:"\u4F5C\u6210\u8005",labelPurpose:"\u7A2E\u985E",labelDescription:"\u8AAC\u660E",labelItemCount:"\u30A2\u30A4\u30C6\u30E0\u6570",labelLastUpdated:"\u6700\u7D42\u8FFD\u52A0\u65E5",purposeList:"\u30EA\u30B9\u30C8",purposeModList:"\u30E2\u30C7\u30EC\u30FC\u30B7\u30E7\u30F3\u30EA\u30B9\u30C8",errorInvalidUri:"\u6709\u52B9\u306A\u30EA\u30B9\u30C8\u3067\u306F\u306A\u3044\u3088\u3046\u3067\u3059",errorGeneric:"\u554F\u984C\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002\u3057\u3070\u3089\u304F\u7D4C\u3063\u3066\u304B\u3089\u304A\u305F\u3081\u3057\u304F\u3060\u3055\u3044\u3002",errorListNotFound:"\u30EA\u30B9\u30C8\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002URL\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002",noItems:"\u3053\u306E\u30EA\u30B9\u30C8\u306B\u306F\u30A2\u30A4\u30C6\u30E0\u304C\u3042\u308A\u307E\u305B\u3093",noDescription:"\u8AAC\u660E\u306A\u3057",labelAcceptTos:"\u306B\u540C\u610F\u3057\u307E\u3059",tosLinkText:"\u5229\u7528\u898F\u7D04",tosLoadError:"\u5229\u7528\u898F\u7D04\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",tosContainerNotFound:"\u5229\u7528\u898F\u7D04\u306E\u5185\u5BB9\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",helpTitle:"\u4F7F\u3044\u65B9",helpBody:`
            <p><strong>\u3053\u306E\u30C4\u30FC\u30EB\u306F\u4F55\u3092\u3059\u308B\u306E\uFF1F</strong></p>
            <p>Bluesky\u306E\u30EA\u30B9\u30C8\u306B\u6700\u5F8C\u306B\u30E6\u30FC\u30B6\u30FC\u304C\u8FFD\u52A0\u3055\u308C\u305F\u65E5\u6642\u3092\u78BA\u8A8D\u3067\u304D\u307E\u3059\u3002</p>
            
            <p><strong>\u4F7F\u3044\u65B9\uFF1A</strong></p>
            <ol>
                <li>Bluesky\u3067\u78BA\u8A8D\u3057\u305F\u3044\u30EA\u30B9\u30C8\u3092\u958B\u304D\u307E\u3059</li>
                <li>\u30EA\u30B9\u30C8\u306EURL\u3092\u30B3\u30D4\u30FC\u3057\u307E\u3059\uFF1A
                    <ul>
                        <li>Bluesky\u30AF\u30E9\u30A4\u30A2\u30F3\u30C8\u306E\u300C...\u300D\u30E1\u30CB\u30E5\u30FC\u304B\u3089\u300C\u30EA\u30B9\u30C8\u3078\u306E\u30EA\u30F3\u30AF\u3092\u30B3\u30D4\u30FC\u300D\u3092\u9078\u629E</li>
                        <li>\u307E\u305F\u306F\u30D6\u30E9\u30A6\u30B6\u306E\u30A2\u30C9\u30EC\u30B9\u30D0\u30FC\u304B\u3089\u30B3\u30D4\u30FC\uFF08\u4F8B\uFF1A<code>https://bsky.app/profile/nus.bsky.social/lists/3khbcfekugt2j</code>\uFF09</li>
                    </ul>
                </li>
                <li>\u5165\u529B\u6B04\u306B\u30DA\u30FC\u30B9\u30C8\u3057\u3066\u300C\u78BA\u8A8D\u300D\u30DC\u30BF\u30F3\u3092\u9078\u629E\u3059\u308B\u3068\u3001\u6700\u7D42\u8FFD\u52A0\u65E5\u304C\u8868\u793A\u3055\u308C\u307E\u3059</li>
            </ol>
            
            <p><strong>\u5225\u306E\u65B9\u6CD5\uFF1A</strong> \u30EA\u30B9\u30C8\u306EAT URI\uFF08\u4F8B\uFF1A<code>at://did:plc:v2tssqq5tlnx4f5qvtpnlw5j/app.bsky.graph.list/3khbcfekugt2j</code>\uFF09\u3092\u76F4\u63A5\u5165\u529B\u3059\u308B\u3053\u3068\u3082\u3067\u304D\u307E\u3059</p>
			<p><strong>\u88DC\u8DB3\uFF1A</strong> \u65E5\u6642\u306F\u30EA\u30B9\u30C8\u306B\u5B58\u5728\u3059\u308B\u6700\u65B0\u306E\u30EC\u30B3\u30FC\u30C9\u306E\u60C5\u5831\u3092\u57FA\u306B\u53D6\u5F97\u3055\u308C\u307E\u3059\u3002</p>
			`}},h=/^at:\/\/([a-zA-Z0-9._-]+(?:\.[a-zA-Z]{2,})?|did:[a-z0-9:%-]+)\/app\.bsky\.graph\.list\/[a-zA-Z0-9]+$/,m="en";function b(){let e=sessionStorage.getItem("language");return e||((navigator.language||navigator.userLanguage).startsWith("ja")?"ja":"en")}function f(e){m=e,sessionStorage.setItem("language",e),document.documentElement.lang=e;let t=y[e];document.getElementById("page-title").textContent=t.pageTitle,document.getElementById("page-description").textContent=t.pageDescription,document.getElementById("submit-text").textContent=t.submitText,document.getElementById("label-creator").textContent=t.labelCreator,document.getElementById("label-purpose").textContent=t.labelPurpose,document.getElementById("label-description").textContent=t.labelDescription,document.getElementById("label-item-count").textContent=t.labelItemCount,document.getElementById("label-last-updated").textContent=t.labelLastUpdated,document.getElementById("help-title").textContent=t.helpTitle,document.getElementById("help-body").innerHTML=t.helpBody;let r=document.getElementById("tos-label");if(r){let o=`<a href="#" id="tos-link">${t.tosLinkText}</a>`;r.innerHTML=e==="ja"?`${o}${t.labelAcceptTos}`:`${t.labelAcceptTos} ${o}`}let s=document.getElementById("language-options");s&&s.querySelectorAll("a").forEach(l=>{l.removeAttribute("aria-current");let i=l.textContent.trim();(e==="ja"&&i==="\u65E5\u672C\u8A9E"||e==="en"&&i==="English")&&l.setAttribute("aria-current","page")})}function a(e){return y[m][e]||e}function L(e){if(h.test(e))return e;let t=/^https:\/\/bsky\.app\/profile\/([a-zA-Z0-9._-]+(?:\.[a-zA-Z]{2,})?|did:[a-z0-9:%-]+)\/lists\/([a-zA-Z0-9]+)$/,r=e.match(t);if(r){let s=r[1],o=r[2];return`at://${s}/app.bsky.graph.list/${o}`}return null}function E(e){return h.test(e)}function I(e){return new Intl.DateTimeFormat(navigator.language,{dateStyle:"medium"}).format(new Date(e))}function p(e){let t=document.getElementById("error-message");t&&(t.textContent=e,t.style.display="block",t.style.color="var(--pico-del-color)")}function k(){let e=document.getElementById("error-message");e&&(e.style.display="none")}function B(e){let t=document.getElementById("result-list-name"),r=document.getElementById("result-creator"),s=document.getElementById("result-purpose"),o=document.getElementById("result-description"),l=document.getElementById("result-item-count"),i=document.getElementById("result-last-updated"),n=document.getElementById("result-card"),d=document.getElementById("description-section");if(!t||!r||!s||!o||!l||!i||!n||!d){console.error("Required elements not found");return}t.textContent="";let c=document.createElement("a");c.href=`https://bsky.app/profile/${encodeURIComponent(e.creatorHandle)}/lists/${encodeURIComponent(e.rkey)}`,c.target="_blank",c.rel="noopener noreferrer",c.textContent=e.name||"Untitled List",t.appendChild(c),r.textContent="";let u=document.createElement("a");u.href=`https://bsky.app/profile/${encodeURIComponent(e.creatorHandle)}`,u.target="_blank",u.rel="noopener noreferrer",u.textContent=`@${e.creatorHandle}`,r.appendChild(u);let g=e.purpose;e.purpose.includes("curatelist")?g=a("purposeList"):e.purpose.includes("modlist")&&(g=a("purposeModList")),s.textContent=g,e.description?(o.textContent=e.description,d.style.display="flex"):(o.textContent=a("noDescription"),d.style.display="flex"),l.textContent=e.listItemCount,e.dateLastAdded?i.textContent=I(e.dateLastAdded):i.textContent=a("noItems"),n.style.display="block",n.scrollIntoView({behavior:"smooth",block:"start"})}function C(e,t){if(e.target.tagName==="A"){e.preventDefault();let s=e.target.textContent.trim()==="\u65E5\u672C\u8A9E"?"ja":"en";f(s),t&&t.removeAttribute("open")}}async function v(e){e.preventDefault(),k();let t=document.getElementById("list-uri"),r=t.value.trim(),s=L(r);if(console.log("Converted URI:",s),!s||!E(s)){p(a("errorInvalidUri"));return}let o=document.getElementById("submit-button"),l=document.getElementById("submit-text"),i=document.getElementById("loading-indicator"),n=document.getElementById("result-card");o.disabled=!0,t.disabled=!0,l.textContent=a("submitTextLoading"),n.style.display="none",i.style.display="block";try{let d=await fetch("/api/list-info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uri:s})});if(!d.ok){(await d.json()).message==="LIST_NOT_FOUND"?p(a("errorListNotFound")):p(a("errorGeneric"));return}let c=await d.json();B(c)}catch(d){console.error("Error:",d),p(a("errorGeneric"))}finally{o.disabled=!1,t.disabled=!1,l.textContent=a("submitText"),i.style.display="none"}}window.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("accept-tos"),t=document.getElementById("submit-button");e&&t&&(t.disabled=!e.checked,e.addEventListener("change",n=>{t.disabled=!n.target.checked})),m=b(),f(m);let r=document.getElementById("language-options"),s=document.querySelector(".language-switcher");r&&r.addEventListener("click",n=>{C(n,s)});let o=document.getElementById("list-form");o&&o.addEventListener("submit",v),document.addEventListener("click",n=>{n.target.id==="tos-link"&&(n.preventDefault(),w())}),document.getElementById("tos-close").addEventListener("click",()=>{document.getElementById("tos-modal").classList.remove("show")}),document.getElementById("tos-modal").addEventListener("click",n=>{n.target.id==="tos-modal"&&document.getElementById("tos-modal").classList.remove("show")}),document.getElementById("help-icon").addEventListener("click",()=>{let n=document.getElementById("help-modal");document.getElementById("help-title").textContent=a("helpTitle"),document.getElementById("help-body").innerHTML=a("helpBody"),n.classList.add("show")}),document.getElementById("help-close").addEventListener("click",()=>{document.getElementById("help-modal").classList.remove("show")}),document.getElementById("help-modal").addEventListener("click",n=>{n.target.id==="help-modal"&&document.getElementById("help-modal").classList.remove("show")}),document.addEventListener("keydown",n=>{n.key==="Escape"&&(document.getElementById("help-modal").classList.remove("show"),document.getElementById("tos-modal").classList.remove("show"))});let i=new URLSearchParams(window.location.search).get("uri");if(i){let n=document.getElementById("list-uri");i&&(n.value=i)}});function T(e,t){let r=e.cloneNode(!0);return r.querySelectorAll("*").forEach(o=>{if(!t.includes(o.tagName)){o.remove();return}if(o.tagName==="A"){let l=o.getAttribute("href");if(l){let n=l.toLowerCase().trim();(n.startsWith("javascript:")||n.startsWith("data:")||n.startsWith("vbscript:"))&&o.removeAttribute("href")}let i=["href","target","rel"];Array.from(o.attributes).forEach(n=>{i.includes(n.name)||o.removeAttribute(n.name)}),o.getAttribute("href")&&(o.setAttribute("target","_blank"),o.setAttribute("rel","noopener noreferrer"))}else Array.from(o.attributes).forEach(l=>{o.removeAttribute(l.name)})}),r}async function w(){let e=document.getElementById("tos-modal"),t=document.getElementById("tos-body");if(!e||!t){console.error("Modal elements not found");return}let r=m==="ja"?"/terms-ja.html":"/terms-en.html";try{let s=await fetch(r);if(!s.ok)throw new Error("Failed to load terms");let o=s.headers.get("content-type");if(!o||!o.includes("text/html"))throw new Error("Invalid content type");let l=await s.text(),d=new DOMParser().parseFromString(l,"text/html").querySelector(".container");if(d){let u=T(d,["P","H1","H2","H3","H4","UL","OL","LI","STRONG","EM","BR","A"]);t.innerHTML=u.innerHTML,e.classList.add("show")}else console.error("Container not found in terms file"),t.textContent=a("tosContainerNotFound"),e.classList.add("show")}catch(s){console.error("Error loading terms:",s),t.textContent=a("tosLoadError"),e.classList.add("show")}}})();
